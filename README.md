# Presidio PII Analyzer üîí

Microsoft Presidio tabanlƒ± g√º√ßl√º bir **Ki≈üisel Bilgi Tespit ve Maskeleme** sistemi. PDF, resim ve CSV dosyalarƒ±ndaki hassas verileri otomatik olarak tespit edip maskeler.

## üìã ƒ∞√ßindekiler

- [√ñzellikler](#√∂zellikler)
- [Proje Yapƒ±sƒ±](#proje-yapƒ±sƒ±)
- [Kurulum](#kurulum)
- [Kullanƒ±m](#kullanƒ±m)
- [Mod√ºl Detaylarƒ±](#mod√ºl-detaylarƒ±)
- [√ñrnekler](#√∂rnekler)
- [Teknik Detaylar](#teknik-detaylar)

---

## üöÄ √ñzellikler

### Ana √ñzellikler
- ‚úÖ **√áoklu Format Desteƒüi**: PDF, Resim (PNG, JPG, etc.), CSV
- üîç **Akƒ±llƒ± PII Tespiti**: Microsoft Presidio ile yapay zeka destekli tespit
- üé≠ **Otomatik Maskeleme**: Tespit edilen verileri otomatik gizleme
- üñºÔ∏è **OCR Desteƒüi**: Resimlerden metin √ßƒ±karma (Tesseract)
- üìä **Detaylƒ± Raporlama**: JSON ve konsol √ßƒ±ktƒ±sƒ±
- üé® **Renkli Terminal**: Kullanƒ±cƒ± dostu g√∂rsel aray√ºz
- ‚ö° **Performans Optimizasyonu**: B√ºy√ºk CSV dosyalarƒ± i√ßin √∂rnekleme desteƒüi
- üéØ **G√ºven E≈üiƒüi Ayarƒ±**: Hassasiyet kontrol√º (threshold)

### Tespit Edilebilen PII T√ºrleri
- üë§ **Ki≈üi ƒ∞simleri** (PERSON)
- üìß **E-posta Adresleri** (EMAIL_ADDRESS)
- üì± **Telefon Numaralarƒ±** (PHONE_NUMBER)
- üè¶ **Kredi Kartƒ± Numaralarƒ±** (CREDIT_CARD)
- üÜî **SSN/TC No** (US_SSN gibi)
- üìç **Adres Bilgileri** (LOCATION)
- üî¢ **IP Adresleri** (IP_ADDRESS)
- üí≥ **IBAN Numaralarƒ±**
- Ve daha fazlasƒ±...

---

## üìÅ Proje Yapƒ±sƒ±

```
presidio-image/
‚îÇ
‚îú‚îÄ‚îÄ main.py                      # Ana uygulama ve CLI aray√ºz√º
‚îú‚îÄ‚îÄ requirements.txt             # Python baƒüƒ±mlƒ±lƒ±klarƒ±
‚îÇ
‚îú‚îÄ‚îÄ analyzers/                   # Analiz mod√ºlleri
‚îÇ   ‚îú‚îÄ‚îÄ pdf_analyzer.py         # PDF dosyalarƒ± i√ßin PII analizi
‚îÇ   ‚îú‚îÄ‚îÄ image_analyzer.py       # Resim dosyalarƒ± i√ßin OCR + PII analizi
‚îÇ   ‚îî‚îÄ‚îÄ csv_analyzer.py         # CSV dosyalarƒ± i√ßin PII analizi
‚îÇ
‚îú‚îÄ‚îÄ maskers/                     # Maskeleme mod√ºlleri
‚îÇ   ‚îú‚îÄ‚îÄ pdf_masker.py           # PDF maskeleme (yeni PDF olu≈üturma)
‚îÇ   ‚îî‚îÄ‚îÄ image_masker.py         # Resim maskeleme (siyah kutular)
‚îÇ
‚îî‚îÄ‚îÄ examples/                    # √ñrnek dosyalar
    ‚îú‚îÄ‚îÄ example_data.pdf
    ‚îú‚îÄ‚îÄ example_data.png
    ‚îú‚îÄ‚îÄ example_data.csv
    ‚îú‚îÄ‚îÄ example_data_masked.pdf
    ‚îú‚îÄ‚îÄ example_data_masked.png
    ‚îî‚îÄ‚îÄ example_data_masked.csv
```

---

## üõ†Ô∏è Kurulum

### Gereksinimler
- Python 3.8 veya √ºzeri
- Tesseract OCR (sistem seviyesinde kurulu olmalƒ±)

### Adƒ±m 1: Tesseract Kurulumu

**macOS:**
```bash
brew install tesseract
```

**Ubuntu/Debian:**
```bash
sudo apt-get install tesseract-ocr
```

**Windows:**
- [Tesseract Windows Installer](https://github.com/UB-Mannheim/tesseract/wiki) adresinden indirin

### Adƒ±m 2: Python Ortamƒ±

```bash
# Depoyu klonlayƒ±n veya indirin
cd presidio-image

# Virtual environment olu≈üturun (√∂nerilen)
python3 -m venv venv

# Virtual environment'ƒ± aktif edin
source venv/bin/activate  # macOS/Linux
# veya
venv\Scripts\activate     # Windows

# Baƒüƒ±mlƒ±lƒ±klarƒ± y√ºkleyin
pip install -r requirements.txt

# Spacy dil modelini indirin (√∂nemli!)
python -m spacy download en_core_web_lg
```

### Adƒ±m 3: Test Edin

```bash
python main.py examples/example_data.csv
```

---

## üéØ Kullanƒ±m

### Temel Komutlar

```bash
# 1. Sadece analiz (PII tespiti)
python main.py dosya.pdf

# 2. Analiz + maskeleme (otomatik dosya adƒ±: dosya_masked.pdf)
python main.py dosya.pdf --anonymize

# 3. √ñzel √ßƒ±ktƒ± dosyasƒ± ile maskeleme
python main.py dosya.pdf --anonymize --output gizli_dosya.pdf

# 4. Resim maskeleme (siyah kutular ile)
python main.py foto.jpg --anonymize

# 5. CSV maskeleme
python main.py veriler.csv --anonymize

# 6. JSON rapor kaydetme
python main.py dosya.pdf --json rapor.json

# 7. G√ºven e≈üiƒüi ayarlama (0.0-1.0 arasƒ±)
python main.py dosya.pdf --threshold 0.5

# 8. B√ºy√ºk CSV i√ßin √∂rnekleme
python main.py buyuk_veri.csv --sample-size 1000 --anonymize

# 9. Sadece belirli entity tiplerini tespit et
python main.py dosya.pdf --entities PERSON EMAIL_ADDRESS PHONE_NUMBER

# 10. JSON formatƒ±nda √ßƒ±ktƒ± al
python main.py dosya.pdf --format json

# 11. Sadece e-posta adreslerini maskele
python main.py veriler.csv --entities EMAIL_ADDRESS --anonymize

# 12. Tam i≈ü akƒ±≈üƒ±
python main.py veriler.csv --anonymize --json rapor.json --threshold 0.4
```

### Entity Filtreleme (Yeni √ñzellik!)

Artƒ±k hangi PII tiplerinin tespit edileceƒüini se√ßebilirsiniz! `--entities` parametresi ile sadece ilgilendiƒüiniz veri tiplerini tespit edebilirsiniz:

```bash
# Sadece ki≈üi isimleri ve e-posta adresleri
python main.py dosya.pdf --entities PERSON EMAIL_ADDRESS

# Sadece ileti≈üim bilgileri
python main.py foto.jpg --entities EMAIL_ADDRESS PHONE_NUMBER URL

# Sadece finansal bilgiler
python main.py belgeler.pdf --entities CREDIT_CARD IBAN_CODE US_BANK_NUMBER

# JSON √ßƒ±ktƒ±sƒ± ile birlikte
python main.py data.csv --entities PERSON EMAIL_ADDRESS --format json
```

**Desteklenen Entity Tipleri:**
- `PERSON` - Ki≈üi isimleri
- `EMAIL_ADDRESS` - E-posta adresleri
- `PHONE_NUMBER` - Telefon numaralarƒ±
- `CREDIT_CARD` - Kredi kartƒ± numaralarƒ±
- `US_SSN` - Sosyal g√ºvenlik numaralarƒ±
- `LOCATION` - Konum bilgileri
- `DATE_TIME` - Tarih ve saat
- `IP_ADDRESS` - IP adresleri
- `URL` - Web adresleri
- Ve daha fazlasƒ±...

Daha detaylƒ± liste i√ßin `ENTITY_TYPES.md` dosyasƒ±na bakƒ±n.

**Avantajlarƒ±:**
- ‚úÖ **Daha hƒ±zlƒ± analiz**: Sadece ihtiyacƒ±nƒ±z olan entity'leri kontrol eder
- ‚úÖ **Daha az false positive**: ƒ∞stemediƒüiniz tespitleri engeller  
- ‚úÖ **√ñzelle≈ütirilebilir**: Her dosya tipine g√∂re farklƒ± entity se√ßimi
- ‚úÖ **Compliance**: Sadece yasal gerekliliklere uyan verileri maskele
```

### Parametreler

| Parametre | Kƒ±sa | A√ßƒ±klama | Varsayƒ±lan |
|-----------|------|----------|------------|
| `file` | - | Analiz edilecek dosya (zorunlu) | - |
| `--anonymize` | `-a` | Maskelenmi≈ü versiyon olu≈ütur | False |
| `--output` | `-o` | √áƒ±ktƒ± dosyasƒ± yolu | `[dosya]_masked.[ext]` |
| `--json` | `-j` | JSON rapor dosyasƒ± | - |
| `--sample-size` | `-s` | CSV i√ßin √∂rnek boyutu | T√ºm satƒ±rlar |
| `--threshold` | `-t` | Minimum g√ºven skoru (0.0-1.0) | 0.35 |
| `--entities` | `-e` | Tespit edilecek entity tipleri | T√ºm√º |
| `--format` | `-f` | √áƒ±ktƒ± formatƒ± (text/json) | text |
| `--no-summary` | - | Konsol √∂zetini atla | False |

---

## üì¶ Mod√ºl Detaylarƒ±

### 1. `main.py` - Ana Uygulama

**Sƒ±nƒ±f:** `PresidioAnalyzerCLI`

**Ama√ß:** Komut satƒ±rƒ± aray√ºz√º ve i≈ü akƒ±≈üƒ± koordinasyonu

**Ana Fonksiyonlar:**
- `get_file_type()`: Dosya uzantƒ±sƒ±na g√∂re tip belirleme
- `analyze_file()`: Dosya analizi ve maskeleme koordinasyonu
- `print_results_summary()`: Sonu√ßlarƒ± renkli konsola yazdƒ±rma
- `run()`: CLI arg√ºman i≈üleme ve ana akƒ±≈ü

**√ñnemli Noktalar:**
- `colorama` ile renkli terminal √ßƒ±ktƒ±sƒ± (platformlar arasƒ± uyumluluk)
- Otomatik dosya adƒ± √ºretimi (`_masked` eki)
- Hata y√∂netimi ve kullanƒ±cƒ± dostu mesajlar
- JSON √ßƒ±ktƒ±sƒ±nda b√ºy√ºk metin alanlarƒ±nƒ±n boyut bilgisine d√∂n√º≈üt√ºr√ºlmesi

---

### 2. `analyzers/pdf_analyzer.py` - PDF Analiz Mod√ºl√º

**Sƒ±nƒ±f:** `PDFAnalyzer`

**Ama√ß:** PDF dosyalarƒ±ndan metin √ßƒ±karƒ±p PII tespit etme

**Ana Fonksiyonlar:**

#### `extract_text_from_pdf(pdf_path: str) -> str`
- **G√∂rev:** PDF'den metin √ßƒ±karma
- **K√ºt√ºphane:** `pdfplumber` (PyPDF2'ye g√∂re daha iyi metin √ßƒ±karma)
- **Detay:** T√ºm sayfalarƒ± d√∂ng√ºyle okur, metinleri birle≈ütirir

#### `analyze_text(text: str, threshold: float = 0.35) -> List[Dict]`
- **G√∂rev:** Metinde PII tespiti
- **Motor:** Presidio AnalyzerEngine
- **√áƒ±ktƒ±:** Entity tipi, metin, pozisyon, g√ºven skoru

#### `anonymize_text(text: str, analyzer_results: List) -> str`
- **G√∂rev:** Tespit edilen PII'larƒ± maskeleme
- **Motor:** Presidio AnonymizerEngine
- **Detay:** Dict formatƒ±nƒ± RecognizerResult'a d√∂n√º≈üt√ºr√ºr

#### `analyze_pdf(pdf_path: str, anonymize: bool, threshold: float) -> Dict`
- **G√∂rev:** Tam PDF analiz i≈ü akƒ±≈üƒ±
- **Adƒ±mlar:**
  1. Metin √ßƒ±karma
  2. PII analizi
  3. (Opsiyonel) Anonymizasyon
- **√áƒ±ktƒ±:** Detaylƒ± sonu√ß dictionary'si

**Neden Bu Kod Yazƒ±ldƒ±:**
PDF dosyalarƒ± i≈ü d√ºnyasƒ±nda en √ßok kullanƒ±lan formattƒ±r. S√∂zle≈ümeler, faturalar, raporlar genelde PDF'dir ve ki≈üisel bilgi i√ßerebilir. Bu mod√ºl PDF'leri g√ºvenli ≈üekilde i≈üler.

---

### 3. `analyzers/image_analyzer.py` - Resim Analiz Mod√ºl√º

**Sƒ±nƒ±f:** `ImageAnalyzer`

**Ama√ß:** Resimlerdeki metni OCR ile okuyup PII tespit etme

**Ana Fonksiyonlar:**

#### `extract_text_from_image(image_path: str) -> str`
- **G√∂rev:** OCR ile metin √ßƒ±karma
- **K√ºt√ºphane:** `pytesseract` (Google Tesseract wrapper)
- **Detay:** PIL Image a√ßar, Tesseract OCR uygular
- **Kullanƒ±m Alanlarƒ±:** Fotoƒüraflar, taranmƒ±≈ü belgeler, ekran g√∂r√ºnt√ºleri

#### `get_image_info(image_path: str) -> Dict`
- **G√∂rev:** Resim metadata bilgisi
- **Bilgiler:** Format, mod, boyut, geni≈ülik, y√ºkseklik
- **Neden:** Debug ve loglama i√ßin faydalƒ±

#### `analyze_text()` ve `anonymize_text()`
- PDF analyzer ile aynƒ± mantƒ±k
- Kod tekrarƒ± yerine payla≈üƒ±lan fonksiyonlar

#### `analyze_image(image_path: str, anonymize: bool, threshold: float) -> Dict`
- **G√∂rev:** Tam resim analiz i≈ü akƒ±≈üƒ±
- **√ñzel Durum:** Resim metadata'sƒ± da sonu√ßta d√∂nd√ºr√ºl√ºr

**Neden Bu Kod Yazƒ±ldƒ±:**
Kullanƒ±cƒ±lar kimlik kartlarƒ±, s√ºr√ºc√º belgeleri, pasaportlar fotoƒüraflayabilir. Sosyal medyada payla≈üƒ±lan ekran g√∂r√ºnt√ºleri ki≈üisel bilgi i√ßerebilir. Bu mod√ºl bu riskleri tespit eder.

---

### 4. `analyzers/csv_analyzer.py` - CSV Analiz Mod√ºl√º

**Sƒ±nƒ±f:** `CSVAnalyzer`

**Ama√ß:** CSV/Excel tablolarƒ±nda kolon bazlƒ± PII analizi

**Ana Fonksiyonlar:**

#### `read_csv(csv_path: str, encoding: str = 'utf-8') -> pd.DataFrame`
- **G√∂rev:** CSV okuma
- **√ñzellik:** Otomatik encoding d√ºzeltme (UTF-8 hata verirse Latin-1 dener)
- **Neden:** Farklƒ± kaynaklardan gelen CSV'ler farklƒ± encoding'e sahip olabilir

#### `analyze_text(text: str, threshold: float = 0.35) -> List[Dict]`
- **√ñzellik:** Pandas NaN kontrol√º (bo≈ü h√ºcre kontrol√º)
- **Detay:** Her h√ºcre deƒüerini string'e √ßevirip analiz eder

#### `analyze_dataframe(df: DataFrame, sample_size: int, threshold: float) -> Dict`
- **G√∂rev:** T√ºm DataFrame'i kolon bazlƒ± analiz
- **√ñnemli √ñzellik:** Sampling (b√ºy√ºk dosyalar i√ßin)
- **√áƒ±ktƒ± Yapƒ±sƒ±:**
  ```python
  {
    "total_columns": int,
    "total_rows": int,
    "analyzed_rows": int,
    "is_sampled": bool,
    "column_results": {
      "column_name": {
        "has_pii": bool,
        "pii_count": int,
        "pii_types": {"PERSON": 5, "EMAIL": 3},
        "all_findings": [
          {
            "row_index": int,
            "value": str,
            "pii_findings": [...]
          }
        ]
      }
    }
  }
  ```

#### `anonymize_dataframe(df: DataFrame, threshold: float) -> DataFrame`
- **G√∂rev:** T√ºm DataFrame'i h√ºcre h√ºcre maskele
- **Performans:** Her h√ºcre i√ßin ayrƒ± analiz (b√ºy√ºk dosyalarda yava≈ü olabilir)
- **√áƒ±ktƒ±:** Yeni bir DataFrame (orijinal deƒüi≈ütirilmez)

#### `analyze_csv()` - Ana ƒ∞≈ü Akƒ±≈üƒ±
- CSV okuma ‚Üí DataFrame analizi ‚Üí ƒ∞statistik hesaplama ‚Üí (Opsiyonel) Anonymizasyon ‚Üí (Opsiyonel) Kaydetme

**Neden Bu Kod Yazƒ±ldƒ±:**
CSV dosyalarƒ± veri biliminde, CRM sistemlerinde, Excel ihracatƒ±nda sƒ±k√ßa kullanƒ±lƒ±r. M√º≈üteri listeleri, kullanƒ±cƒ± veritabanlarƒ±, anket sonu√ßlarƒ± genelde CSV formatƒ±ndadƒ±r. Her kolon farklƒ± tip veri i√ßerebilir, bu y√ºzden kolon bazlƒ± analiz √∂nemlidir.

---

### 5. `maskers/pdf_masker.py` - PDF Maskeleme Mod√ºl√º

**Sƒ±nƒ±f:** `PDFMasker`

**Ama√ß:** Maskelenmi≈ü metni yeni PDF dosyasƒ± olarak kaydetme

**Ana Fonksiyonlar:**

#### `escape_html_entities(text: str) -> str`
- **Problem:** Reportlab, `<`, `>` karakterlerini HTML tag olarak yorumlar
- **√á√∂z√ºm:** `<` ‚Üí `&lt;`, `>` ‚Üí `&gt;` d√∂n√º≈ü√ºm√º
- **√ñrnek:** `<EMAIL_ADDRESS>` ‚Üí `&lt;EMAIL_ADDRESS&gt;`

#### `create_masked_pdf(original_pdf_path: str, anonymized_text: str, output_path: str)`
- **G√∂rev:** Yeni PDF olu≈üturma
- **K√ºt√ºphane:** `reportlab` (Python'da PDF olu≈üturma i√ßin standart)
- **Yapƒ±:**
  - `SimpleDocTemplate`: PDF yapƒ±sƒ±
  - `Paragraph`: Metin bloklarƒ±
  - `Spacer`: Paragraflar arasƒ± bo≈üluk
- **Stil:** 11pt font, 14pt satƒ±r aralƒ±ƒüƒ±, custom paragraph style
- **Detaylar:**
  - `\n\n` ile paragraf ayrƒ±mƒ±
  - `\n` ile satƒ±r ayrƒ±mƒ± ‚Üí `<br/>` tag'ine d√∂n√º≈ü√ºm
  - Gereksiz bo≈üluklarƒ± temizleme

**Neden Bu Kod Yazƒ±ldƒ±:**
Orijinal PDF'in layout'unu korumak zor olduƒüundan, maskelenmi≈ü metin yeni bir PDF olarak olu≈üturulur. Bu, programatik olarak en g√ºvenilir y√∂ntemdir. Kullanƒ±cƒ± orijinal PDF ile maskelenmi≈ü PDF'i kar≈üƒ±la≈ütƒ±rabilir.

---

### 6. `maskers/image_masker.py` - Resim Maskeleme Mod√ºl√º

**Sƒ±nƒ±f:** `ImageMasker`

**Ama√ß:** Resim √ºzerinde tespit edilen PII'larƒ±n √ºzerine siyah kutular √ßizme

**Ana Fonksiyonlar:**

#### `get_text_boxes(image_path: str) -> Dict`
- **G√∂rev:** Tesseract OCR ile her kelimenin koordinatlarƒ±nƒ± alma
- **API:** `pytesseract.image_to_data()` with `Output.DICT`
- **√áƒ±ktƒ±:** Her kelime i√ßin x, y, width, height

#### `find_text_positions(ocr_data: Dict, text_to_mask: str) -> List[Dict]`
- **G√∂rev:** Belirli bir metni OCR sonu√ßlarƒ±nda bulma
- **Algoritma:**
  1. Her iki metni normalize et (k√º√ß√ºk harf, bo≈üluksuz)
  2. Kelime kelime kar≈üƒ±la≈ütƒ±r
  3. E≈üle≈üen kelimelerin koordinatlarƒ±nƒ± d√∂nd√ºr
- **√ñnemli:** Partial matching yapƒ±yor (√∂rn: "John" i√ßinde "ohn" da bulunur)

#### `create_masked_image(image_path: str, pii_findings: List, output_path: str, mask_color: str = 'black')`
- **G√∂rev:** Maskelenmi≈ü resim olu≈üturma
- **Adƒ±mlar:**
  1. Resmi PIL ile a√ß
  2. `ImageDraw` nesnesi olu≈ütur
  3. Her PII i√ßin OCR koordinatlarƒ±nƒ± bul
  4. Her koordinat √ºzerine siyah dikd√∂rtgen √ßiz
  5. 2 piksel padding ekle (kelimeleri tam kapsasƒ±n)
  6. Maskelenmi≈ü resmi kaydet

**Teknik Detaylar:**
- PIL (Pillow) kullanarak in-memory image manipulation
- OCR ve maskeleme aynƒ± resim √ºzerinde (koordinat e≈üle≈ümesi garanti)
- Mask color parametrik (siyah dƒ±≈üƒ±nda blur da eklenebilir)

**Neden Bu Kod Yazƒ±ldƒ±:**
Resimlerde metin maskelemek i√ßin iki y√∂ntem var:
1. OCR + yeni resim olu≈üturma (zor, layout bozulur)
2. Orijinal resim √ºzerine √ßizim (bu yakla≈üƒ±m)

ƒ∞kinci y√∂ntem daha hƒ±zlƒ±, daha g√ºvenilir ve orijinal resmin kalitesini korur.

---

## üß™ √ñrnekler

### √ñrnek 1: PDF Analizi

```bash
python main.py examples/example_data.pdf
```

**√áƒ±ktƒ±:**
```
===========================================================
  Presidio PII Analyzer
  Analyze PDF, Images, and CSV files for PII
===========================================================

Analyzing PDF file: examples/example_data.pdf
Please wait...

Analysis Results:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
File: examples/example_data.pdf
PII Found: True
Total PII Instances: 8

PII Details:

  PERSON:
    - John Doe (confidence: 0.85)
    - Jane Smith (confidence: 0.90)

  EMAIL_ADDRESS:
    - john@example.com (confidence: 1.00)
    - jane@example.com (confidence: 1.00)

  PHONE_NUMBER:
    - +1-555-0123 (confidence: 0.95)
    ... and 3 more

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

‚úì Analysis complete!
```

### √ñrnek 2: CSV Maskeleme

```bash
python main.py examples/example_data.csv --anonymize
```

**Orijinal CSV:**
```csv
Name,Email,Phone
John Doe,john@example.com,555-0123
Jane Smith,jane@example.com,555-0456
```

**Maskelenmi≈ü CSV (`example_data_masked.csv`):**
```csv
Name,Email,Phone
<PERSON>,<EMAIL_ADDRESS>,<PHONE_NUMBER>
<PERSON>,<EMAIL_ADDRESS>,<PHONE_NUMBER>
```

### √ñrnek 3: Resim Maskeleme

```bash
python main.py examples/example_data.png --anonymize --output secure.png
```

**Sonu√ß:**
- Orijinal resim: `example_data.png`
- Maskelenmi≈ü: `secure.png` (PII'lar √ºzerinde siyah kutular)

### √ñrnek 4: JSON Rapor

```bash
python main.py data.csv --json report.json --threshold 0.5
```

**JSON √áƒ±ktƒ±:**
```json
{
  "file_path": "data.csv",
  "analysis": {
    "total_columns": 3,
    "total_rows": 100,
    "analyzed_rows": 100,
    "is_sampled": false,
    "column_results": {
      "Email": {
        "has_pii": true,
        "pii_count": 100,
        "pii_types": {
          "EMAIL_ADDRESS": 100
        }
      }
    }
  },
  "summary": {
    "columns_with_pii": 1,
    "total_pii_instances": 100
  }
}
```

---

## üî¨ Teknik Detaylar

### Microsoft Presidio Nedir?

**Presidio**, Microsoft tarafƒ±ndan geli≈ütirilen a√ßƒ±k kaynaklƒ± PII tespit ve maskeleme k√ºt√ºphanesidir.

**√áalƒ±≈üma Prensibi:**
1. **Pattern Matching**: Regex ile format tespiti (email, telefon, kredi kartƒ±)
2. **Named Entity Recognition (NER)**: Spacy ile AI tabanlƒ± isim tespiti
3. **Checksum Validation**: Luhn algoritmasƒ± ile kredi kartƒ± doƒürulama
4. **Context Awareness**: "SSN:" yazƒ±sƒ±nƒ±n yanƒ±ndaki sayƒ±larƒ± SSN olarak tanƒ±ma

**Desteklenen Mod√ºller:**
- `presidio-analyzer`: PII tespiti
- `presidio-anonymizer`: PII maskeleme
- `presidio-image-redactor`: Resim redaksiyonu (bu projede kullanƒ±lmƒ±yor, custom √ß√∂z√ºm var)

### Spacy ve NLP

**Spacy** modern NLP k√ºt√ºphanesidir. Bu projede `en_core_web_lg` modeli kullanƒ±lƒ±yor:
- **lg** (large): 560MB boyut, y√ºksek doƒüruluk
- **Alternatifler:** `en_core_web_sm` (k√º√ß√ºk, hƒ±zlƒ±) veya `en_core_web_md` (orta)

**NER (Named Entity Recognition):**
- C√ºmledeki varlƒ±klarƒ± tanƒ±r (PERSON, ORG, GPE, DATE, etc.)
- Machine learning ile eƒüitilmi≈ü
- T√ºrk√ße i√ßin `tr_core_news_lg` modeli kullanƒ±labilir

### Tesseract OCR

**Tesseract**, Google'ƒ±n a√ßƒ±k kaynaklƒ± OCR motorudur.

**√ñzellikler:**
- 100+ dil desteƒüi
- Eƒüitilebilir (custom model eƒüitimi)
- Farklƒ± Page Segmentation Modes (PSM)

**Bu Projede Kullanƒ±mƒ±:**
```python
# Basit metin √ßƒ±karma
text = pytesseract.image_to_string(image)

# Koordinat bilgisiyle √ßƒ±karma
data = pytesseract.image_to_data(image, output_type=Output.DICT)
# data['text'], data['left'], data['top'], data['width'], data['height']
```

### Threshold (G√ºven E≈üiƒüi) Nedir?

**Threshold**, tespitin ne kadar emin olunmasƒ± gerektiƒüini belirler (0.0 - 1.0).

**√ñrnekler:**
- `threshold=0.35` (varsayƒ±lan): Orta hassasiyet, daha fazla tespit
- `threshold=0.50`: Dengeli
- `threshold=0.70`: Y√ºksek hassasiyet, sadece √ßok emin olanlar
- `threshold=0.20`: √áok d√º≈ü√ºk, false positive (yanlƒ±≈ü pozitif) artar

**Kullanƒ±m Senaryolarƒ±:**
- **D√º≈ü√ºk threshold (0.2-0.4)**: Hi√ßbir PII ka√ßƒ±rƒ±lmasƒ±n
- **Y√ºksek threshold (0.6-0.8)**: Sadece kesin olanlarƒ± maskele

### Encoding Sorunlarƒ±

CSV mod√ºl√ºnde encoding otomatik d√ºzeltmesi var:

```python
try:
    df = pd.read_csv(csv_path, encoding='utf-8')  # ƒ∞lk deneme
except UnicodeDecodeError:
    df = pd.read_csv(csv_path, encoding='latin-1')  # Alternatif
```

**Neden:** Windows Excel'den export edilen CSV'ler genelde Latin-1 (ISO-8859-1) encoding'e sahiptir.

### Sampling (√ñrnekleme)

B√ºy√ºk CSV dosyalarƒ± i√ßin performans optimizasyonu:

```python
if sample_size and len(df) > sample_size:
    df_to_analyze = df.sample(n=sample_size, random_state=42)
```

**√ñrnek:**
- 1 milyon satƒ±rlƒ±k CSV ‚Üí `--sample-size 10000` ile 10.000 satƒ±r analiz edilir
- `random_state=42`: Her √ßalƒ±≈ütƒ±rmada aynƒ± √∂rneklemi se√ßer (reproducible)

---

## üìä Performans ve Sƒ±nƒ±rlamalar

### Performans

| Dosya Tipi | Boyut | Yakla≈üƒ±k S√ºre | Notlar |
|------------|-------|---------------|--------|
| PDF | 10 sayfa | 5-10 saniye | Metin yoƒüunluƒüuna baƒülƒ± |
| Resim | 1920x1080 | 3-5 saniye | OCR s√ºresi dominant |
| CSV | 10.000 satƒ±r | 30-60 saniye | Kolon sayƒ±sƒ±na baƒülƒ± |
| CSV | 100.000 satƒ±r | 5-10 dakika | Sampling √∂nerilir |

### Sƒ±nƒ±rlamalar

1. **OCR Doƒüruluƒüu**: D√º≈ü√ºk kaliteli resimler veya el yazƒ±sƒ± metinler zor okunur
2. **PDF Layout**: Maskelenmi≈ü PDF orijinal formatƒ± korumaz
3. **B√ºy√ºk Dosyalar**: CSV anonymizasyon t√ºm satƒ±rlar i√ßin tekrar analiz yapar (yava≈ü)
4. **Dil Desteƒüi**: Sadece ƒ∞ngilizce NER modeli y√ºkl√º (T√ºrk√ße i√ßin ek kurulum gerekir)
5. **Baƒülam**: Presidio her zaman baƒülamƒ± anlayamayabilir ("John" bir isim mi yoksa "John Doe Pizza" marka mƒ±?)

### Optimizasyon ƒ∞pu√ßlarƒ±

```bash
# B√ºy√ºk CSV i√ßin sampling kullan
python main.py large.csv --sample-size 5000

# Threshold y√ºkselterek false positive'leri azalt
python main.py data.pdf --threshold 0.6

# JSON kaydetmeyerek √ßƒ±ktƒ±yƒ± hƒ±zlandƒ±r
python main.py data.csv --no-summary
```

---

## üîê G√ºvenlik ve Gizlilik

### Veri G√ºvenliƒüi

‚úÖ **Yerel ƒ∞≈üleme**: T√ºm analiz lokal makinede yapƒ±lƒ±r, veri internete g√∂nderilmez
‚úÖ **Orijinal Korunur**: Maskeleme yeni dosya olu≈üturur, orijinal deƒüi≈ümez
‚úÖ **No API Calls**: Microsoft Presidio yerel √ßalƒ±≈üƒ±r, API key gerekmez

‚ö†Ô∏è **Dikkat Edilmesi Gerekenler:**
- Maskelenmi≈ü dosyalar hassas bilgi i√ßerebilir (threshold'a g√∂re)
- JSON raporlarƒ± PII √∂rnekleri i√ßerir (g√ºvenli saklayƒ±n)
- OCR hatasƒ± y√ºz√ºnden bazƒ± PII'lar ka√ßabilir

### √ñnerilen ƒ∞≈ü Akƒ±≈üƒ±

1. **Test Edin**: √ñnce √∂rnek dosyalarla test edin
2. **Threshold Ayarƒ±**: Veri tipinize g√∂re optimize edin
3. **Manuel Kontrol**: Maskelenmi≈ü dosyalarƒ± manuel kontrol edin
4. **G√ºvenli Saklama**: Raporlarƒ± ≈üifreli ortamda saklayƒ±n
5. **Log Temizliƒüi**: Eski analiz sonu√ßlarƒ±nƒ± d√ºzenli silin

---

## üõ†Ô∏è Geli≈ütirme ve Katkƒ±

### Yeni Entity Tipi Ekleme

Presidio'ya custom recognizer ekleyebilirsiniz:

```python
from presidio_analyzer import PatternRecognizer

tc_recognizer = PatternRecognizer(
    supported_entity="TR_ID_NUMBER",
    patterns=[{"name": "tc_pattern", "regex": r"\b[1-9]\d{10}\b", "score": 0.8}]
)

analyzer = AnalyzerEngine()
analyzer.registry.add_recognizer(tc_recognizer)
```

### Hata Ayƒ±klama

```python
# Debug modu i√ßin loglama ekleyin
import logging
logging.basicConfig(level=logging.DEBUG)
```

### Test Etme

```bash
# T√ºm √∂rnek dosyalarƒ± test et
for file in examples/example_data.*; do
    echo "Testing: $file"
    python main.py "$file" --anonymize
done
```

---

## üìö Kaynaklar

### Dok√ºmantasyon
- [Microsoft Presidio](https://microsoft.github.io/presidio/)
- [Spacy Documentation](https://spacy.io/usage)
- [Tesseract OCR](https://github.com/tesseract-ocr/tesseract)
- [ReportLab User Guide](https://www.reportlab.com/docs/reportlab-userguide.pdf)

### ƒ∞lgili Projeler
- [presidio-demo](https://github.com/microsoft/presidio-demo): Web UI demo
- [pdfplumber](https://github.com/jsvine/pdfplumber): PDF extraction
- [pytesseract](https://github.com/madmaze/pytesseract): Python Tesseract wrapper

---

## ü§ù Destek ve ƒ∞leti≈üim

### Sorun Giderme

**Problem:** Tesseract bulunamƒ±yor
```bash
# macOS
brew install tesseract

# Ubuntu
sudo apt-get install tesseract-ocr
```

**Problem:** Spacy modeli yok
```bash
python -m spacy download en_core_web_lg
```

**Problem:** PDF okuma hatasƒ±
- pdfplumber yerine PyPDF2 deneyin
- PDF ≈üifreli olabilir (≈üifre kaldƒ±rƒ±n)

**Problem:** T√ºrk√ße metin tespit edilmiyor
```bash
# T√ºrk√ße Tesseract dili
sudo apt-get install tesseract-ocr-tur  # Ubuntu
brew install tesseract-lang  # macOS

# T√ºrk√ße Spacy modeli
pip install spacy-tr-model
python -m spacy download tr_core_news_lg
```

---

## üìÑ Lisans

Bu proje eƒüitim ve ara≈ütƒ±rma ama√ßlƒ±dƒ±r. Ticari kullanƒ±m i√ßin ilgili k√ºt√ºphanelerin lisanslarƒ±nƒ± kontrol edin:
- Presidio: MIT License
- Tesseract: Apache License 2.0
- Spacy: MIT License

---

## üéì Sonu√ß

Bu proje, **veri gizliliƒüi** ve **GDPR/KVKK uyumluluƒüu** i√ßin g√º√ßl√º bir ara√ßtƒ±r. √ñzellikle:
- üìã Veri payla≈üƒ±mƒ±ndan √∂nce PII temizleme
- üîç Compliance audit i√ßin PII tespiti
- üéì Veri bilimi projelerinde hassas veri maskeleme
- üìä Test ortamlarƒ± i√ßin anonymize veri setleri olu≈üturma

senaryolarƒ±nda kullanƒ±labilir.

---

**üîí G√ºvenli veri i≈üleme!**

